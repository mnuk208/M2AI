<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AI-CheckMate by MÂ²AI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-light: #f3f4f6;
        --bg-dark: #111827;
        --text-light: #111827;
        --text-dark: #f3f4f6;
        --card-light: #ffffff;
        --card-dark: #1f2937;
        --accent: #2563eb;
        --error: #dc2626;
      }

      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background-color: var(--bg-light);
        color: var(--text-light);
        transition: background-color 0.4s, color 0.4s;
      }

      html.dark body {
        background-color: var(--bg-dark);
        color: var(--text-dark);
      }

      .container {
        max-width: 1000px;
        margin: 40px auto;
        background: var(--card-light);
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      html.dark .container {
        background: var(--card-dark);
      }

      h1 {
        text-align: center;
        color: var(--accent);
      }

      .theme-toggle {
        position: absolute;
        top: 20px;
        right: 30px;
        cursor: pointer;
        background: transparent;
        border: 2px solid var(--accent);
        border-radius: 20px;
        padding: 6px 14px;
        color: var(--accent);
      }

      textarea {
        width: 100%;
        min-height: 150px;
        padding: 15px;
        font-size: 1rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        overflow: auto;
      }

      .button-group {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 15px;
        flex-wrap: wrap;
      }

      button {
        background-color: var(--accent);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
      }

      input[type="file"] {
        background: none;
        color: inherit;
        border: none;
        font-family: inherit;
        padding: 0;
      }

      .spinner {
        display: none;
        margin: 15px auto;
        border: 6px solid #f3f3f3;
        border-top: 6px solid var(--accent);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 0.9s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .gauge-section {
        display: none;
        justify-content: center;
        gap: 40px;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .gauge-block {
        text-align: center;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle at 30% 30%, #333, #111);
        border-radius: 50%;
        box-shadow: inset -5px -5px 15px rgba(255, 255, 255, 0.1),
          inset 5px 5px 15px rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        color: #ffa726;
        font-weight: bold;
        font-size: 1.25rem;
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
      }

      .gauge-label {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #fff;
        font-size: 1.2rem;
        text-align: center;
      }

      .footer {
        margin-top: 40px;
        text-align: center;
        font-size: 0.9rem;
        color: #666;
      }

      .footer img {
        height: 24px;
        vertical-align: middle;
        margin-left: 8px;
      }
    </style>
  </head>
  <body>
    <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">
      ðŸŒ™
    </button>
    <div class="container">
      <h1>Analyze the Human or AI Origin of Your Text</h1>
      <form method="post" onsubmit="handleAnalyze(event)">
        <textarea
          id="input_text"
          name="input_text"
          placeholder="Paste text here..."
        ></textarea>
        <small style="color: gray; display: block; margin-top: 6px">
          Tip: For accurate detection, enter at least
          <strong>100 words</strong>.
        </small>
        <div class="button-group">
          <button type="submit">Analyze</button>
          <button type="button" onclick="recalibrate()">Reset</button>
          <input
            type="file"
            id="fileInput"
            accept=".txt,.doc,.docx,.pdf,.ppt,.pptx"
          />
        </div>
        <div class="spinner" id="spinner"></div>
      </form>
      <div class="gauge-section" id="gaugeSection">
        <div class="gauge-block">
          <canvas id="aiGauge" width="300" height="300"></canvas>
          <div class="gauge-label">
            AI Likelihood: <span id="aiValue">0%</span>
          </div>
        </div>
        <div class="gauge-block">
          <canvas id="humanGauge" width="300" height="300"></canvas>
          <div class="gauge-label">
            Human Likelihood: <span id="humanValue">0%</span>
          </div>
        </div>
      </div>
      <div class="footer">
        Powered by AI-CheckMate Team. <br />Copyrights &copy; 2025 reserved for
        <img src="/static/logo.png" alt="Logo" />
      </div>
    </div>

    <script>
      const toggleBtn = document.getElementById("theme-toggle");
      const spinner = document.getElementById("spinner");
      const gaugeSection = document.getElementById("gaugeSection");
      const fileInput = document.getElementById("fileInput");

      function applySavedTheme() {
        const theme = localStorage.getItem("theme");
        const isDark = theme === "dark";
        document.documentElement.classList.toggle("dark", isDark);
        toggleBtn.textContent = isDark ? "ðŸŒ™" : "ðŸŒž";
      }

      function toggleTheme() {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        toggleBtn.textContent = isDark ? "ðŸŒ™" : "ðŸŒž";
      }

      function showSpinner() {
        spinner.style.display = "block";
      }

      function hideSpinner() {
        spinner.style.display = "none";
      }

      function recalibrate() {
        document.getElementById("input_text").value = "";
        hideSpinner();
        gaugeSection.style.display = "none";
        fileInput.value = "";
      }

      window.onload = () => {
        applySavedTheme();
      };

      fileInput.addEventListener("change", handleFileUpload);

      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        if (file.name.endsWith(".txt")) {
          reader.onload = () => {
            document.getElementById("input_text").value = reader.result;
          };
          reader.readAsText(file);
        } else {
          alert("Only .txt supported in this version.");
        }
      }

      function drawGauge(canvasId, percent, color) {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext("2d");
        const radius = canvas.width / 2;
        const centerX = radius;
        const centerY = radius;
        const outerRadius = radius - 20;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.beginPath();
        ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);
        ctx.strokeStyle = "#444";
        ctx.lineWidth = 20;
        ctx.stroke();

        const targetAngle = percent * 2 * Math.PI;
        let currentAngle = 0;
        const animate = () => {
          if (currentAngle < targetAngle) {
            currentAngle += 0.05;
            if (currentAngle > targetAngle) currentAngle = targetAngle;
            ctx.beginPath();
            ctx.arc(
              centerX,
              centerY,
              outerRadius,
              -Math.PI / 2,
              -Math.PI / 2 + currentAngle
            );
            ctx.strokeStyle = color;
            ctx.lineWidth = 20;
            ctx.stroke();
            requestAnimationFrame(animate);
          }
        };
        animate();

        for (let i = 0; i <= 100; i += 10) {
          const angle = (i / 100) * 2 * Math.PI - Math.PI / 2;
          const inner = outerRadius - 12;
          const outer = outerRadius + 1;
          const x1 = centerX + inner * Math.cos(angle);
          const y1 = centerY + inner * Math.sin(angle);
          const x2 = centerX + outer * Math.cos(angle);
          const y2 = centerY + outer * Math.sin(angle);
          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.strokeStyle = "#ccc";
          ctx.lineWidth = 2;
          ctx.stroke();

          const labelX = centerX + (outerRadius - 30) * Math.cos(angle);
          const labelY = centerY + (outerRadius - 30) * Math.sin(angle);
          ctx.fillStyle = "#ccc";
          ctx.font = "12px Inter";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(i.toString(), labelX, labelY);
        }
      }

      async function handleAnalyze(event) {
        event.preventDefault();
        showSpinner();

        const inputText = document.getElementById("input_text").value;
        if (!inputText.trim()) return hideSpinner();

        const wordCount = inputText.trim().split(/\s+/).length;
        if (wordCount < 100) {
          alert("Tip: For better accuracy, please enter at least 100 words.");
        }

        try {
          const response = await fetch("/analyze", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ input_text: inputText }),
          });

          if (!response.ok) throw new Error("Server error!");

          const data = await response.json();
          const aiScore = data.ai_likelihood_percent;
          const humanScore = 100 - aiScore;

          updateGauges(aiScore, humanScore);
          gaugeSection.style.display = "flex";
        } catch (error) {
          alert("Analysis failed: " + error.message);
        } finally {
          hideSpinner();
        }
      }

      function updateGauges(aiPercent, humanPercent) {
        drawGauge("aiGauge", aiPercent / 100, "#dc2626");
        drawGauge("humanGauge", humanPercent / 100, "#10b981");
        document.getElementById("aiValue").textContent = aiPercent + "%";
        document.getElementById("humanValue").textContent = humanPercent + "%";
      }
    </script>
  </body>
</html>
